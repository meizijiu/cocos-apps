{"version":3,"sources":["file:///Users/mzwine/Codes/other/cocos-apps/watermelon/assets/GameScene/GameSceneCtrl.ts"],"names":["_decorator","Component","Node","PhysicsSystem","Prefab","instantiate","Vec3","RigidBody","director","v3","Quat","fruit_config","CLIP","AudioHelper","NCKeys","NotificationCenter","Utils","FruitCtrl","CanvasCtrl","ccclass","property","GameSceneCtrl","curFruit","onLoad","loadResWithCorrection","err","prefab","node","parent","getScene","play","BGM","instance","enable","schedule","updateForGameOver","onEnable","addObserver","MERGE_NEW_FRUIT","onMergeNewFruit","RESET_GAME","onRestGame","REBORN_GAME","onRebornGame","REFRESH_CUR_FRUIT","onRefreshCurFruit","createCurFruit","onDisable","removeObserver","id","randomNextFruit","position","fruitPrefabs","getComponent","enabled","fruitContainer","ctrl","playBornAnimation","labelingNode","active","dropFruit","rigidBody","setLinearVelocity","setAngularVelocity","scheduleOnce","offsetCurFruit","offset","pos","add","x","z","removeAllChildren","canvasCtrl","reset","reborn","fruitId","destroy","particle","smokePrefab","scale","setTimeout","data","eulerX","Math","random","eulerY","eulerZ","rotation","fromEuler","addScore","score","length","GREAT","addWatermelon","deltaTime","children","i","y","subLife","popGameOverLayer","unschedule"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,a,OAAAA,a;AAAeC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAA2CC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,Q,OAAAA,Q;AAAUC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,I,OAAAA,I;;AACrIC,MAAAA,Y,uBAAAA,Y;;AACAC,MAAAA,I,0BAAAA,I;;AACAC,MAAAA,W,4BAAAA,W;;AACAC,MAAAA,M,mCAAAA,M;AAAQC,MAAAA,kB,mCAAAA,kB;;AACRC,MAAAA,K,sBAAAA,K;;AACAC,MAAAA,S,cAAAA,S;;AACAC,MAAAA,U,iBAAAA,U;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBpB,U;;+BAGjBqB,a,WADZF,OAAO,CAAC,eAAD,C,UAGLC,QAAQ,CAAC,CAAChB,MAAD,CAAD,C,UAGRgB,QAAQ,CAAClB,IAAD,C,UAGRkB,QAAQ;AAAA;AAAA,mC,UAGRA,QAAQ,CAAClB,IAAD,C,UAGRkB,QAAQ,CAAChB,MAAD,C,oCAfX,MACaiB,aADb,SACmCpB,SADnC,CAC6C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAiBpCqB,QAjBoC,GAiBnB,IAjBmB;AAAA;;AAoB3CC,QAAAA,MAAM,GAAG;AACP;AAAA;AAAA,8BAAMC,qBAAN,CAA4B,OAA5B,EAAqCpB,MAArC,EAA6C,CAACqB,GAAD,EAAMC,MAAN,KAAiB;AAC5D,gBAAID,GAAJ,EAAS;AACT,gBAAIE,IAAU,GAAGtB,WAAW,CAACqB,MAAD,CAA5B;AACAC,YAAAA,IAAI,CAACC,MAAL,GAAcpB,QAAQ,CAACqB,QAAT,EAAd;AACA;AAAA;AAAA,4CAAYC,IAAZ,CAAiB,OAAjB,EAA0B;AAAA;AAAA,8BAAKC,GAA/B,EAAoC,IAApC,EAA0C,GAA1C;AACD,WALD;AAOA5B,UAAAA,aAAa,CAAC6B,QAAd,CAAuBC,MAAvB,GAAgC,IAAhC;AACA,eAAKC,QAAL,CAAc,KAAKC,iBAAnB,EAAsC,CAAtC;AACD;;AAEDC,QAAAA,QAAQ,GAAG;AACT;AAAA;AAAA,wDAAmBC,WAAnB,CAA+B;AAAA;AAAA,gCAAOC,eAAtC,EAAuD,KAAKC,eAA5D,EAA6E,IAA7E;AACA;AAAA;AAAA,wDAAmBF,WAAnB,CAA+B;AAAA;AAAA,gCAAOG,UAAtC,EAAkD,KAAKC,UAAvD,EAAmE,IAAnE;AACA;AAAA;AAAA,wDAAmBJ,WAAnB,CAA+B;AAAA;AAAA,gCAAOK,WAAtC,EAAmD,KAAKC,YAAxD,EAAsE,IAAtE;AACA;AAAA;AAAA,wDAAmBN,WAAnB,CAA+B;AAAA;AAAA,gCAAOO,iBAAtC,EAAyD,KAAKC,iBAA9D,EAAiF,IAAjF;AACA,eAAKC,cAAL;AACD;;AAEDC,QAAAA,SAAS,GAAG;AACV;AAAA;AAAA,wDAAmBC,cAAnB,CAAkC;AAAA;AAAA,gCAAOV,eAAzC,EAA0D,IAA1D;AACA;AAAA;AAAA,wDAAmBU,cAAnB,CAAkC;AAAA;AAAA,gCAAOR,UAAzC,EAAqD,IAArD;AACA;AAAA;AAAA,wDAAmBQ,cAAnB,CAAkC;AAAA;AAAA,gCAAON,WAAzC,EAAsD,IAAtD;AACA;AAAA;AAAA,wDAAmBM,cAAnB,CAAkC;AAAA;AAAA,gCAAOJ,iBAAzC,EAA4D,IAA5D;AACD;;AAGDE,QAAAA,cAAc,GAAG;AACf,cAAI,KAAKxB,QAAT,EAAmB;AACnB,cAAI2B,EAAE,GAAG;AAAA;AAAA,8BAAMC,eAAN,EAAT;AACA,cAAIC,QAAQ,GAAG,IAAI7C,IAAJ,CAAS,CAAT,EAAY,EAAZ,EAAgB,CAAhB,CAAf;AACA,cAAIqB,IAAU,GAAGtB,WAAW,CAAC,KAAK+C,YAAL,CAAkBH,EAAlB,CAAD,CAA5B;AACAtB,UAAAA,IAAI,CAACwB,QAAL,GAAgBA,QAAhB;AACAxB,UAAAA,IAAI,CAAC0B,YAAL,CAAkB9C,SAAlB,EAA6B+C,OAA7B,GAAuC,KAAvC;AACA3B,UAAAA,IAAI,CAACC,MAAL,GAAc,KAAK2B,cAAnB;AACA,cAAIC,IAAI,GAAG7B,IAAI,CAAC0B,YAAL;AAAA;AAAA,qCAAX;AACAG,UAAAA,IAAI,CAACC,iBAAL,CAAuB,GAAvB;AACA,eAAKnC,QAAL,GAAgBK,IAAhB;AACA,eAAK+B,YAAL,CAAkBC,MAAlB,GAA2B,IAA3B;AACA,eAAKD,YAAL,CAAkBP,QAAlB,GAA6B,IAAI7C,IAAJ,CAAS,CAAT,EAAY,EAAZ,EAAgB,CAAhB,CAA7B;AACD;;AAEDsD,QAAAA,SAAS,GAAG;AACV,cAAI,CAAC,KAAKtC,QAAV,EACE;AAEF,cAAIuC,SAAS,GAAG,KAAKvC,QAAL,CAAc+B,YAAd,CAA2B9C,SAA3B,CAAhB;AACAsD,UAAAA,SAAS,CAACP,OAAV,GAAoB,IAApB;AACAO,UAAAA,SAAS,CAACC,iBAAV,CAA4B,IAAIxD,IAAJ,CAAS,CAAT,EAAY,CAAC,EAAb,EAAiB,CAAjB,CAA5B;AACAuD,UAAAA,SAAS,CAACE,kBAAV,CAA6B,IAAIzD,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,CAA7B;AACA,eAAKgB,QAAL,GAAgB,IAAhB;AACA,eAAK0C,YAAL,CAAkB,KAAKlB,cAAvB,EAAuC,CAAvC;AACA,eAAKY,YAAL,CAAkBC,MAAlB,GAA2B,KAA3B;AACD;;AAEDM,QAAAA,cAAc,CAACC,MAAD,EAAe;AAC3B,cAAIC,GAAG,GAAG1D,EAAE,CAAC,KAAKa,QAAL,CAAc6B,QAAf,CAAZ;AACAgB,UAAAA,GAAG,CAACC,GAAJ,CAAQF,MAAR;AAEA,cAAIC,GAAG,CAACE,CAAJ,IAAS,CAAC,EAAd,EAAkBF,GAAG,CAACE,CAAJ,GAAQ,CAAC,EAAT,CAAlB,KACK,IAAIF,GAAG,CAACE,CAAJ,GAAQ,EAAZ,EAAgBF,GAAG,CAACE,CAAJ,GAAQ,EAAR;AAErB,cAAIF,GAAG,CAACG,CAAJ,GAAQ,CAAC,EAAb,EAAiBH,GAAG,CAACG,CAAJ,GAAQ,CAAC,EAAT,CAAjB,KACK,IAAIH,GAAG,CAACG,CAAJ,GAAQ,EAAZ,EAAgBH,GAAG,CAACG,CAAJ,GAAQ,EAAR;AAErB,eAAKhD,QAAL,CAAc6B,QAAd,GAAyBgB,GAAzB;AACA,eAAKT,YAAL,CAAkBP,QAAlB,GAA6B,IAAI7C,IAAJ,CAAS6D,GAAG,CAACE,CAAb,EAAgB,EAAhB,EAAoBF,GAAG,CAACG,CAAxB,CAA7B;AACD;;AAGD7B,QAAAA,UAAU,GAAG;AACX,eAAKc,cAAL,CAAoBgB,iBAApB;AACA,eAAKjD,QAAL,GAAgB,IAAhB;AACA,eAAKwB,cAAL;AACA3C,UAAAA,aAAa,CAAC6B,QAAd,CAAuBC,MAAvB,GAAgC,IAAhC;AACA,eAAKuC,UAAL,CAAgBC,KAAhB;AACA,eAAKvC,QAAL,CAAc,KAAKC,iBAAnB,EAAsC,CAAtC;AACD;;AAEDQ,QAAAA,YAAY,GAAG;AACbxC,UAAAA,aAAa,CAAC6B,QAAd,CAAuBC,MAAvB,GAAgC,IAAhC;AACA,eAAKuC,UAAL,CAAgBE,MAAhB;AACA,eAAKxC,QAAL,CAAc,KAAKC,iBAAnB,EAAsC,CAAtC;AACD;;AAEDU,QAAAA,iBAAiB,CAAC8B,OAAD,EAAU;AACzB,cAAI,KAAKrD,QAAT,EAAmB,KAAKA,QAAL,CAAcsD,OAAd;AACnB,cAAI3B,EAAE,GAAG0B,OAAT;AACA,cAAIxB,QAAQ,GAAG,IAAI7C,IAAJ,CAAS,CAAT,EAAY,EAAZ,EAAgB,CAAhB,CAAf;AACA,cAAIqB,IAAU,GAAGtB,WAAW,CAAC,KAAK+C,YAAL,CAAkBH,EAAlB,CAAD,CAA5B;AACAtB,UAAAA,IAAI,CAACwB,QAAL,GAAgBA,QAAhB;AACAxB,UAAAA,IAAI,CAAC0B,YAAL,CAAkB9C,SAAlB,EAA6B+C,OAA7B,GAAuC,KAAvC;AACA3B,UAAAA,IAAI,CAACC,MAAL,GAAc,KAAK2B,cAAnB;AACA,cAAIC,IAAI,GAAG7B,IAAI,CAAC0B,YAAL;AAAA;AAAA,qCAAX;AACAG,UAAAA,IAAI,CAACC,iBAAL,CAAuB,GAAvB;AACA,eAAKnC,QAAL,GAAgBK,IAAhB;AACA,eAAK+B,YAAL,CAAkBC,MAAlB,GAA2B,IAA3B;AACA,eAAKD,YAAL,CAAkBP,QAAlB,GAA6B,IAAI7C,IAAJ,CAAS,CAAT,EAAY,EAAZ,EAAgB,CAAhB,CAA7B;AAEA,cAAIuE,QAAc,GAAGxE,WAAW,CAAC,KAAKyE,WAAN,CAAhC;AACAD,UAAAA,QAAQ,CAACE,KAAT,GAAiB,IAAIzE,IAAJ,CAAS;AAAA;AAAA,4CAAa2C,EAAb,EAAiB8B,KAA1B,EAAiC;AAAA;AAAA,4CAAa9B,EAAb,EAAiB8B,KAAlD,EAAyD;AAAA;AAAA,4CAAa9B,EAAb,EAAiB8B,KAA1E,CAAjB;AACAF,UAAAA,QAAQ,CAAC1B,QAAT,GAAoBxB,IAAI,CAACwB,QAAzB;AACA0B,UAAAA,QAAQ,CAACjD,MAAT,GAAkBpB,QAAQ,CAACqB,QAAT,EAAlB;AACAmD,UAAAA,UAAU,CAAC,MAAM;AACfH,YAAAA,QAAQ,CAACD,OAAT;AACD,WAFS,EAEP,IAFO,CAAV;AAID;AACD;AACF;AACA;;;AACErC,QAAAA,eAAe,CAAC0C,IAAD,EAAO;AACpB,cAAItD,IAAU,GAAGtB,WAAW,CAAC,KAAK+C,YAAL,CAAkB6B,IAAI,CAAChC,EAAvB,CAAD,CAA5B;AACAtB,UAAAA,IAAI,CAACwB,QAAL,GAAgB8B,IAAI,CAAC9B,QAArB;AACA,cAAI+B,MAAM,GAAGC,IAAI,CAACC,MAAL,KAAgB,GAA7B;AACA,cAAIC,MAAM,GAAGF,IAAI,CAACC,MAAL,KAAgB,GAA7B;AACA,cAAIE,MAAM,GAAGH,IAAI,CAACC,MAAL,KAAgB,GAA7B;AACAzD,UAAAA,IAAI,CAAC4D,QAAL,GAAgB7E,IAAI,CAAC8E,SAAL,CAAe,IAAI9E,IAAJ,EAAf,EAAyBwE,MAAzB,EAAiCG,MAAjC,EAAyCC,MAAzC,CAAhB;AACA3D,UAAAA,IAAI,CAACC,MAAL,GAAc,KAAK2B,cAAnB;AACA5B,UAAAA,IAAI,CAAC0B,YAAL;AAAA;AAAA,sCAA6BI,iBAA7B;AACA,cAAIoB,QAAc,GAAGxE,WAAW,CAAC,KAAKyE,WAAN,CAAhC;AACAD,UAAAA,QAAQ,CAACE,KAAT,GAAiB,IAAIzE,IAAJ,CAAS;AAAA;AAAA,4CAAa2E,IAAI,CAAChC,EAAlB,EAAsB8B,KAA/B,EAAsC;AAAA;AAAA,4CAAaE,IAAI,CAAChC,EAAlB,EAAsB8B,KAA5D,EAAmE;AAAA;AAAA,4CAAaE,IAAI,CAAChC,EAAlB,EAAsB8B,KAAzF,CAAjB;AACAF,UAAAA,QAAQ,CAAC1B,QAAT,GAAoB8B,IAAI,CAAC9B,QAAzB;AAEA0B,UAAAA,QAAQ,CAACjD,MAAT,GAAkBpB,QAAQ,CAACqB,QAAT,EAAlB;AACAmD,UAAAA,UAAU,CAAC,MAAM;AACfH,YAAAA,QAAQ,CAACD,OAAT;AACD,WAFS,EAEP,IAFO,CAAV;AAGA,eAAKJ,UAAL,CAAgBiB,QAAhB,CAAyB;AAAA;AAAA,4CAAaR,IAAI,CAAChC,EAAlB,EAAsByC,KAA/C,EAjBoB,CAmBpB;;AACA,cAAIT,IAAI,CAAChC,EAAL,IAAW;AAAA;AAAA,4CAAa0C,MAAb,GAAsB,CAArC,EAAwC;AACtCX,YAAAA,UAAU,CAAC,MAAM;AACf;AAAA;AAAA,8CAAYlD,IAAZ,CAAiB,OAAjB,EAA0B;AAAA;AAAA,gCAAK8D,KAA/B;AACA,kBAAIf,QAAc,GAAGxE,WAAW,CAAC,KAAKyE,WAAN,CAAhC;AACAD,cAAAA,QAAQ,CAACE,KAAT,GAAiB,IAAIzE,IAAJ,CAAS;AAAA;AAAA,gDAAa2E,IAAI,CAAChC,EAAlB,EAAsB8B,KAA/B,EAAsC;AAAA;AAAA,gDAAaE,IAAI,CAAChC,EAAlB,EAAsB8B,KAA5D,EAAmE;AAAA;AAAA,gDAAaE,IAAI,CAAChC,EAAlB,EAAsB8B,KAAzF,CAAjB;AACAF,cAAAA,QAAQ,CAAC1B,QAAT,GAAoBxB,IAAI,CAACwB,QAAzB;AAEA0B,cAAAA,QAAQ,CAACjD,MAAT,GAAkBpB,QAAQ,CAACqB,QAAT,EAAlB;AACAmD,cAAAA,UAAU,CAAC,MAAM;AACfH,gBAAAA,QAAQ,CAACD,OAAT;AACD,eAFS,EAEP,IAFO,CAAV;AAGAjD,cAAAA,IAAI,CAACiD,OAAL;AACA,mBAAKJ,UAAL,CAAgBqB,aAAhB;AACA,mBAAKrB,UAAL,CAAgBE,MAAhB,GAZe,CAaf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACD,aArBS,EAqBP,IArBO,CAAV;AAsBD;AAEF;;AAGDvC,QAAAA,iBAAiB,CAAC2D,SAAD,EAAoB;AACnC,cAAIC,QAAQ,GAAG,KAAKxC,cAAL,CAAoBwC,QAAnC;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,QAAQ,CAACJ,MAA7B,EAAqCK,CAAC,EAAtC,EAA0C;AACxC,gBAAID,QAAQ,CAACC,CAAD,CAAR,CAAY7C,QAAZ,CAAqB8C,CAArB,IAA0B,CAAC,EAA/B,EAAmC;AACjCF,cAAAA,QAAQ,CAACC,CAAD,CAAR,CAAYpB,OAAZ;;AACA,kBAAI,KAAKJ,UAAL,CAAgB0B,OAAhB,MAA6B,KAAjC,EAAwC;AACtC,qBAAK1B,UAAL,CAAgB2B,gBAAhB;AACAhG,gBAAAA,aAAa,CAAC6B,QAAd,CAAuBC,MAAvB,GAAgC,KAAhC;AACA,qBAAKmE,UAAL,CAAgB,KAAKjE,iBAArB;AACD;;AACD;AACD;AACF;AACF;;AAjM0C,O;;;;;iBAGN,E;;;;;;;iBAGP,I;;;;;;;iBAGE,I;;;;;;;iBAGJ,I;;;;;;;iBAGC,I","sourcesContent":["import { _decorator, Component, Node, PhysicsSystem, Prefab, instantiate, Vec3, TERRAIN_HEIGHT_BASE, ModelComponent, RigidBody, director, v3, Quat, Tween, CapsuleCollider } from 'cc';\nimport { fruit_config } from '../Config/fruit_config';\nimport { CLIP } from '../GlobalScript/AudioCtrl';\nimport { AudioHelper } from '../GlobalScript/AudioHelper';\nimport { NCKeys, NotificationCenter } from '../GlobalScript/NotificationCenter';\nimport { Utils } from '../GlobalScript/Utils';\nimport { FruitCtrl } from './FruitCtrl';\nimport { CanvasCtrl } from './ui/CanvasCtrl';\nconst { ccclass, property } = _decorator;\n\n@ccclass('GameSceneCtrl')\nexport class GameSceneCtrl extends Component {\n\n  @property([Prefab])\n  public fruitPrefabs: Array<Prefab> = [];\n\n  @property(Node)\n  public fruitContainer: Node = null;\n\n  @property(CanvasCtrl)\n  public canvasCtrl: CanvasCtrl = null;\n\n  @property(Node)\n  public labelingNode: Node = null;\n\n  @property(Prefab)\n  public smokePrefab: Prefab = null;\n\n  public curFruit: Node = null;\n\n\n  onLoad() {\n    Utils.loadResWithCorrection('audio', Prefab, (err, prefab) => {\n      if (err) return;\n      let node: Node = instantiate(prefab);\n      node.parent = director.getScene() as Node;\n      AudioHelper.play('audio', CLIP.BGM, true, 0.3);\n    });\n\n    PhysicsSystem.instance.enable = true;\n    this.schedule(this.updateForGameOver, 1);\n  }\n\n  onEnable() {\n    NotificationCenter.addObserver(NCKeys.MERGE_NEW_FRUIT, this.onMergeNewFruit, this);\n    NotificationCenter.addObserver(NCKeys.RESET_GAME, this.onRestGame, this);\n    NotificationCenter.addObserver(NCKeys.REBORN_GAME, this.onRebornGame, this);\n    NotificationCenter.addObserver(NCKeys.REFRESH_CUR_FRUIT, this.onRefreshCurFruit, this);\n    this.createCurFruit();\n  }\n\n  onDisable() {\n    NotificationCenter.removeObserver(NCKeys.MERGE_NEW_FRUIT, this);\n    NotificationCenter.removeObserver(NCKeys.RESET_GAME, this);\n    NotificationCenter.removeObserver(NCKeys.REBORN_GAME, this);\n    NotificationCenter.removeObserver(NCKeys.REFRESH_CUR_FRUIT, this);\n  }\n\n\n  createCurFruit() {\n    if (this.curFruit) return;\n    let id = Utils.randomNextFruit();\n    let position = new Vec3(0, 50, 0);\n    let node: Node = instantiate(this.fruitPrefabs[id]);\n    node.position = position;\n    node.getComponent(RigidBody).enabled = false;\n    node.parent = this.fruitContainer;\n    let ctrl = node.getComponent(FruitCtrl);\n    ctrl.playBornAnimation(0.1);\n    this.curFruit = node;\n    this.labelingNode.active = true;\n    this.labelingNode.position = new Vec3(0, 25, 0);\n  }\n\n  dropFruit() {\n    if (!this.curFruit)\n      return;\n\n    let rigidBody = this.curFruit.getComponent(RigidBody);\n    rigidBody.enabled = true;\n    rigidBody.setLinearVelocity(new Vec3(0, -60, 0));\n    rigidBody.setAngularVelocity(new Vec3(1, 1, 1));\n    this.curFruit = null;\n    this.scheduleOnce(this.createCurFruit, 1);\n    this.labelingNode.active = false;\n  }\n\n  offsetCurFruit(offset: Vec3) {\n    let pos = v3(this.curFruit.position);\n    pos.add(offset);\n\n    if (pos.x <= -12) pos.x = -12;\n    else if (pos.x > 12) pos.x = 12;\n\n    if (pos.z < -12) pos.z = -12;\n    else if (pos.z > 12) pos.z = 12;\n\n    this.curFruit.position = pos;\n    this.labelingNode.position = new Vec3(pos.x, 25, pos.z);\n  }\n\n\n  onRestGame() {\n    this.fruitContainer.removeAllChildren();\n    this.curFruit = null;\n    this.createCurFruit();\n    PhysicsSystem.instance.enable = true;\n    this.canvasCtrl.reset();\n    this.schedule(this.updateForGameOver, 1);\n  }\n\n  onRebornGame() {\n    PhysicsSystem.instance.enable = true;\n    this.canvasCtrl.reborn();\n    this.schedule(this.updateForGameOver, 1);\n  }\n\n  onRefreshCurFruit(fruitId) {\n    if (this.curFruit) this.curFruit.destroy();\n    let id = fruitId;\n    let position = new Vec3(0, 50, 0);\n    let node: Node = instantiate(this.fruitPrefabs[id]);\n    node.position = position;\n    node.getComponent(RigidBody).enabled = false;\n    node.parent = this.fruitContainer;\n    let ctrl = node.getComponent(FruitCtrl);\n    ctrl.playBornAnimation(0.1);\n    this.curFruit = node;\n    this.labelingNode.active = true;\n    this.labelingNode.position = new Vec3(0, 25, 0);\n\n    let particle: Node = instantiate(this.smokePrefab);\n    particle.scale = new Vec3(fruit_config[id].scale, fruit_config[id].scale, fruit_config[id].scale);\n    particle.position = node.position;\n    particle.parent = director.getScene() as Node;\n    setTimeout(() => {\n      particle.destroy();\n    }, 1000);\n\n  }\n  /*\n    id, position\n  */\n  onMergeNewFruit(data) {\n    let node: Node = instantiate(this.fruitPrefabs[data.id]);\n    node.position = data.position;\n    let eulerX = Math.random() * 360;\n    let eulerY = Math.random() * 360;\n    let eulerZ = Math.random() * 360;\n    node.rotation = Quat.fromEuler(new Quat, eulerX, eulerY, eulerZ);\n    node.parent = this.fruitContainer;\n    node.getComponent(FruitCtrl).playBornAnimation();\n    let particle: Node = instantiate(this.smokePrefab);\n    particle.scale = new Vec3(fruit_config[data.id].scale, fruit_config[data.id].scale, fruit_config[data.id].scale);\n    particle.position = data.position;\n\n    particle.parent = director.getScene() as Node;\n    setTimeout(() => {\n      particle.destroy();\n    }, 1000);\n    this.canvasCtrl.addScore(fruit_config[data.id].score);\n\n    //合成了大西瓜\n    if (data.id == fruit_config.length - 1) {\n      setTimeout(() => {\n        AudioHelper.play('audio', CLIP.GREAT);\n        let particle: Node = instantiate(this.smokePrefab);\n        particle.scale = new Vec3(fruit_config[data.id].scale, fruit_config[data.id].scale, fruit_config[data.id].scale);\n        particle.position = node.position;\n\n        particle.parent = director.getScene() as Node;\n        setTimeout(() => {\n          particle.destroy();\n        }, 1000);\n        node.destroy();\n        this.canvasCtrl.addWatermelon();\n        this.canvasCtrl.reborn();\n        // let tween = new Tween(node);\n        // tween\n        //   .to(0.2, { position: new Vec3(12, 30, 15) })\n        //   .delay(15)\n        //   .call(() => {\n        //    \n        //   })\n        //   .start();\n      }, 1000);\n    }\n\n  }\n\n\n  updateForGameOver(deltaTime: number) {\n    let children = this.fruitContainer.children;\n    for (let i = 0; i < children.length; i++) {\n      if (children[i].position.y <= -10) {\n        children[i].destroy();\n        if (this.canvasCtrl.subLife() == false) {\n          this.canvasCtrl.popGameOverLayer();\n          PhysicsSystem.instance.enable = false;\n          this.unschedule(this.updateForGameOver);\n        }\n        return;\n      }\n    }\n  }\n}\n"]}