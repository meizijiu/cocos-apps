{"version":3,"sources":["file:///Users/mzwine/Codes/other/cocos-apps/watermelon/assets/GameScene/ui/CanvasCtrl.ts"],"names":["_decorator","Component","Node","Prefab","instantiate","Tween","Vec3","LabelTickCtrl","GameOverLayerCtrl","ccclass","property","CanvasCtrl","score","life","start","hearts","length","reset","scoreLabelTick","tickLabel","watermelonContainer","destroyAllChildren","watermelonTitle","active","reborn","i","node","tween","to","scale","subLife","call","addScore","val","addWatermelon","watermelonPrefab","parent","ZERO","ONE","easing","popGameOverLayer","gameOverPrefab","getComponent","init"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;;AACzDC,MAAAA,a,8BAAAA,a;;AACAC,MAAAA,iB,mCAAAA,iB;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBV,U;;4BAGjBW,U,WADZF,OAAO,CAAC,YAAD,C,UAGLC,QAAQ;AAAA;AAAA,yC,UAIRA,QAAQ,CAACR,IAAD,C,UAERQ,QAAQ,CAACR,IAAD,C,UAGRQ,QAAQ,CAACP,MAAD,C,UAIRO,QAAQ,CAACP,MAAD,C,UAGRO,QAAQ,CAAC,CAACR,IAAD,CAAD,C,oCAnBX,MACaS,UADb,SACgCV,SADhC,CAC0C;AAAA;AAAA;;AAAA;;AAAA,eAIjCW,KAJiC,GAIjB,CAJiB;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAoBjCC,IApBiC,GAoBlB,CApBkB;AAAA;;AAuBxCC,QAAAA,KAAK,GAAG;AACN,eAAKD,IAAL,GAAY,KAAKE,MAAL,CAAYC,MAAxB;AACD;;AAEDC,QAAAA,KAAK,GAAG;AACN,eAAKL,KAAL,GAAa,CAAb;AACA,eAAKM,cAAL,CAAoBC,SAApB,CAA8B,IAA9B,EAAoC,CAApC,EAAuC,GAAvC;AACA,eAAKC,mBAAL,CAAyBC,kBAAzB;AACA,eAAKC,eAAL,CAAqBC,MAArB,GAA8B,KAA9B;AACA,eAAKC,MAAL;AACD;;AAEDA,QAAAA,MAAM,GAAG;AACP,eAAKX,IAAL,GAAY,KAAKE,MAAL,CAAYC,MAAxB;;AACA,eAAK,IAAIS,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKV,MAAL,CAAYC,MAAhC,EAAwCS,CAAC,EAAzC,EAA6C;AAC3C,gBAAIC,IAAI,GAAG,KAAKX,MAAL,CAAYU,CAAZ,CAAX;AACAC,YAAAA,IAAI,CAACH,MAAL,GAAc,IAAd;AACA,gBAAII,KAAK,GAAG,IAAItB,KAAJ,CAAUqB,IAAV,CAAZ;AACAC,YAAAA,KAAK,CACFC,EADH,CACM,GADN,EACW;AAAEC,cAAAA,KAAK,EAAE,IAAIvB,IAAJ,CAAS,GAAT,EAAc,GAAd,EAAmB,GAAnB;AAAT,aADX,EAEGsB,EAFH,CAEM,GAFN,EAEW;AAAEC,cAAAA,KAAK,EAAE,IAAIvB,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf;AAAT,aAFX,EAGGQ,KAHH;AAID;AACF;;AAEDgB,QAAAA,OAAO,GAAG;AACR,eAAKjB,IAAL;AAEA,cAAIa,IAAI,GAAG,KAAKX,MAAL,CAAY,KAAKF,IAAjB,CAAX;AACA,cAAIc,KAAK,GAAG,IAAItB,KAAJ,CAAUqB,IAAV,CAAZ;AACAC,UAAAA,KAAK,CACFC,EADH,CACM,GADN,EACW;AAAEC,YAAAA,KAAK,EAAE,IAAIvB,IAAJ,CAAS,GAAT,EAAc,GAAd,EAAmB,GAAnB;AAAT,WADX,EAEGsB,EAFH,CAEM,GAFN,EAEW;AAAEC,YAAAA,KAAK,EAAE,IAAIvB,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf;AAAT,WAFX,EAGGyB,IAHH,CAGQ,MAAM;AACVL,YAAAA,IAAI,CAACH,MAAL,GAAc,KAAd;AACD,WALH,EAMGT,KANH;AAQA,iBAAO,KAAKD,IAAL,GAAY,CAAnB;AACD;;AAEDmB,QAAAA,QAAQ,CAACC,GAAD,EAAM;AACZ,eAAKrB,KAAL,IAAcqB,GAAd;AACA,eAAKf,cAAL,CAAoBC,SAApB,CAA8B,IAA9B,EAAoC,KAAKP,KAAzC,EAAgD,CAAhD;AACD;;AAEDsB,QAAAA,aAAa,GAAG;AACd,cAAIR,IAAI,GAAGtB,WAAW,CAAC,KAAK+B,gBAAN,CAAtB;AACAT,UAAAA,IAAI,CAACU,MAAL,GAAc,KAAKhB,mBAAnB;AACAM,UAAAA,IAAI,CAACG,KAAL,GAAavB,IAAI,CAAC+B,IAAlB;AACA,cAAIV,KAAK,GAAG,IAAItB,KAAJ,CAAUqB,IAAV,CAAZ;AACAC,UAAAA,KAAK,CACFC,EADH,CACM,GADN,EACW;AAAEC,YAAAA,KAAK,EAAEvB,IAAI,CAACgC;AAAd,WADX,EACgC;AAAEC,YAAAA,MAAM,EAAE;AAAV,WADhC,EAEGzB,KAFH;AAGA,eAAKQ,eAAL,CAAqBC,MAArB,GAA8B,IAA9B;AACD;;AAEDiB,QAAAA,gBAAgB,GAAG;AACjB,cAAId,IAAI,GAAGtB,WAAW,CAAC,KAAKqC,cAAN,CAAtB;AACAf,UAAAA,IAAI,CAACgB,YAAL;AAAA;AAAA,sDAAsCC,IAAtC,CAA2C,KAAK/B,KAAhD;AACAc,UAAAA,IAAI,CAACU,MAAL,GAAc,KAAKV,IAAnB;AACD;;AApFuC,O;;;;;iBAGD,I;;;;;;;iBAIJ,I;;;;;;;iBAEJ,I;;;;;;;iBAGG,I;;;;;;;iBAIF,I;;;;;;;iBAGH,E","sourcesContent":["import { _decorator, Component, Node, Prefab, instantiate, Tween, Vec3, Label, TERRAIN_HEIGHT_BASE } from 'cc';\nimport { LabelTickCtrl } from '../../GlobalScript/LabelTickCtrl';\nimport { GameOverLayerCtrl } from './gameOverLayer/GameOverLayerCtrl';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('CanvasCtrl')\nexport class CanvasCtrl extends Component {\n\n  @property(LabelTickCtrl)\n  public scoreLabelTick: LabelTickCtrl = null;\n  public score: number = 0;\n\n  @property(Node)\n  public watermelonContainer: Node = null;\n  @property(Node)\n  public watermelonTitle: Node = null;\n\n  @property(Prefab)\n  public watermelonPrefab: Prefab = null;\n\n\n  @property(Prefab)\n  public gameOverPrefab: Prefab = null;\n\n  @property([Node])\n  public hearts: Array<Node> = [];\n  public life: number = 0\n\n\n  start() {\n    this.life = this.hearts.length;\n  }\n\n  reset() {\n    this.score = 0;\n    this.scoreLabelTick.tickLabel(null, 0, 0.1);\n    this.watermelonContainer.destroyAllChildren();\n    this.watermelonTitle.active = false;\n    this.reborn();\n  }\n\n  reborn() {\n    this.life = this.hearts.length;\n    for (let i = 0; i < this.hearts.length; i++) {\n      let node = this.hearts[i];\n      node.active = true;\n      let tween = new Tween(node);\n      tween\n        .to(0.1, { scale: new Vec3(1.1, 1.1, 1.1,) })\n        .to(0.2, { scale: new Vec3(1, 1, 1,) })\n        .start();\n    }\n  }\n\n  subLife() {\n    this.life--;\n\n    let node = this.hearts[this.life];\n    let tween = new Tween(node);\n    tween\n      .to(0.1, { scale: new Vec3(1.2, 1.2, 1.2,) })\n      .to(0.1, { scale: new Vec3(0, 0, 0,) })\n      .call(() => {\n        node.active = false;\n      })\n      .start();\n\n    return this.life > 0;\n  }\n\n  addScore(val) {\n    this.score += val;\n    this.scoreLabelTick.tickLabel(null, this.score, 1);\n  }\n\n  addWatermelon() {\n    let node = instantiate(this.watermelonPrefab);\n    node.parent = this.watermelonContainer;\n    node.scale = Vec3.ZERO;\n    let tween = new Tween(node);\n    tween\n      .to(0.4, { scale: Vec3.ONE }, { easing: 'elasticOut' })\n      .start();\n    this.watermelonTitle.active = true;\n  }\n\n  popGameOverLayer() {\n    let node = instantiate(this.gameOverPrefab);\n    node.getComponent(GameOverLayerCtrl)!.init(this.score);\n    node.parent = this.node;\n  }\n}\n"]}